<app-navigation></app-navigation>
<app-sidebar style="position: relative;"></app-sidebar>
<div class="profile-container">
    <div *ngIf="isLoading" class="loading-message">Loading profile information...</div>
    <img *ngIf="!isLoading && profileImgUrl" src="{{ profileImgUrl }}" alt="Profile Picture" class="profile-picture-preview"/>
    <div *ngIf="!isLoading && isViewingOtherUser" class="other-user-profile">
        <h1>{{ userName }}'s Profile</h1>
        
        <div class="profile-info-readonly">
            <div class="info-item">
                <label>Username: </label>
                <span>{{ userName }}</span>
            </div>
            <br>
            
            <div class="info-item">
                <label>About me:</label>
                <p>{{ about || 'No information provided.' }}</p>
            </div>
        </div>
        
    </div>
    <div *ngIf="!isLoading && !isViewingOtherUser">
        <h1>{{userName}}  {{ isNewUser ? 'Complete Your Profile' : '' }}</h1>
  <form #profileForm="ngForm" (ngSubmit)="onSubmit(profileForm)">
    <div class="form-group">
    <label for="userName">userName:</label>
    <input type="text" id="userName" name="userName" [required]="isNewUser" [readonly]="!isNewUser" [class.readonly]="!isNewUser" [(ngModel)]="userName" #userNameInput="ngModel" minlength="3" maxlength="50" />

    <div *ngIf="userNameInput.invalid && userNameInput.touched && isNewUser" class="error-message">
      <span *ngIf="userNameInput.errors?.['required']">userName is required.</span>
      <span *ngIf="userNameInput.errors?.['minlength']">userName must be at least 3 characters long.</span>
      <span *ngIf="userNameInput.errors?.['maxlength']">userName cannot be more than 50 characters long.</span>
    </div>
    </div>

    <div class="form-group">
    <label for="email">Email:</label>
    <input type="email" id="email" name="email" readonly class="readonly" [(ngModel)]="email"/>
    <small class="help-text">Email cannot be changed</small>
    </div>

    <div class="form-group">
    <label for="password">Password:</label>
    <input type="password" id="password" name="password" [required]="isNewUser" [readonly]="!isNewUser" [class.readonly]="!isNewUser" [(ngModel)]="userPassword" #passwordInput="ngModel" minlength="8"/>

    <div *ngIf="passwordInput.invalid && passwordInput.touched && isNewUser" class="error-message">
      <span *ngIf="passwordInput.errors?.['required']">Password is required.</span>
      <span *ngIf="passwordInput.errors?.['minlength']">Password must be at least 8 characters long.</span>
    </div>
    <small *ngIf="!isNewUser" class="help-text">Password cannot be changed</small>
    </div>

    <div class="form-group">
    <label for="about">About:</label>
    <textarea id="about" name="about" required [(ngModel)]="about" #aboutInput="ngModel" minlength="10" maxlength="500" placeholder="Tell us about yourself..."></textarea>

    <div *ngIf="aboutInput.invalid && aboutInput.touched" class="error-message">
      <span *ngIf="aboutInput.errors?.['required']">About section is required.</span>
      <span *ngIf="aboutInput.errors?.['minlength']">About section must be at least 10 characters long.</span>
      <span *ngIf="aboutInput.errors?.['maxlength']">About section cannot exceed 500 characters long.</span>
    </div>
    </div>

    <div class="form-group">
    <label for="profilePicture">Upload Profile Picture:</label>
    <button type="button" (click)="openWidget()" class="upload-button">{{ profileImgUrl ? 'Change Picture' : 'Upload Picture' }}</button>
    <div class="thumbnails"></div>    
    </div>

    <button type="submit" [disabled]="profileForm.invalid" [class.disabled]="profileForm.invalid" class="submit-button">{{ isNewUser ? 'Create Profile' : 'Update Profile' }}</button>

    <button *ngIf="!isNewUser" type="button" (click)="cancelUpdate()" class="cancel-button">Cancel</button>
  </form>

  <div *ngIf="profileForm.invalid && profileForm.touched" class="form-submit-error">Please complete all required fields.</div>
  <div class="user-info">
      <p *ngIf="isNewUser" class="info-message">
        <strong>New User:</strong> Please complete all fields to create your profile.
      </p>
      <p *ngIf="!isNewUser" class="info-message">
        <strong>Note:</strong> You can only update your About section and profile picture.
      </p>
    </div>
    </div>
    
</div>
